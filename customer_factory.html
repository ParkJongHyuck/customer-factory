<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ê³ ê° ê³µì¥ ë‹¤ì´ì–´ê·¸ë¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: white;
        }

        .wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .date-header {
            text-align: center;
            margin-bottom: 8px;
            display: none;
        }

        .date-label {
            font-size: 13px;
            color: #6c757d;
            font-weight: 600;
            margin-right: 6px;
        }

        .date-value {
            font-size: 14px;
            color: #212529;
            font-weight: 700;
        }
        
        .diagram-container {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        .loading {
            text-align: center;
            color: #6c757d;
            font-size: 14px;
        }

        .error-message {
            text-align: center;
            color: #856404;
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            margin-top: 8px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .error-message strong {
            font-weight: 600;
        }

        svg {
            width: 100%;
            height: auto;
        }

        .node-box {
            fill: white;
            stroke: #6c757d;
            stroke-width: 2;
            rx: 20;
        }

        .node-factory {
            fill: white;
            stroke: #6c757d;
            stroke-width: 2;
        }

        .node-text-title {
            font-size: 14px;
            font-weight: 600;
            fill: #495057;
            text-anchor: middle;
        }

        .node-text-value {
            font-size: 16px;
            font-weight: 700;
            fill: #212529;
            text-anchor: middle;
        }

        .comparison-text {
            font-size: 11px;
            font-weight: 600;
            text-anchor: middle;
        }

        .comparison-increase {
            fill: #28a745;
        }

        .comparison-decrease {
            fill: #dc3545;
        }

        .arrow {
            stroke: #6c757d;
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead);
        }

        .arrow-curved {
            stroke: #6c757d;
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead);
        }

        .arrow-return {
            stroke: #e53e3e;
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead-return);
        }

        .arrow-label {
            font-size: 12px;
            fill: #6c757d;
            text-anchor: middle;
        }

        .rate-label {
            font-size: 12pt;
            fill: #6c757d;
            text-anchor: middle;
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <div class="date-header" id="date-header">
            <span class="date-label">ê³ ê° ê³µì¥:</span>
            <span class="date-value" id="date-value">-</span>
        </div>
        <div class="diagram-container" id="diagram-container">
            <div class="loading-overlay" id="loading-overlay">
                <div class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</div>
            </div>
        </div>
        <div class="error-message" id="error-message"></div>
    </div>

    <script>
        // í•˜ë“œì½”ë”©ëœ ì„¤ì •ê°’
        const SHEET_ID = '1Up0FHYHBlYzZhdDvcVBe9xHZWVxefUQNg5CRgXlzZbE';
        const API_KEY = 'AIzaSyCtgQLWJiGP1c4GfY-gLXBnIZNZH71XMVc';
        const SHEET_NAME = '2026';

        // ê¸°ë³¸ê°’ (ì—ëŸ¬ ì‹œ ì‚¬ìš©)
        const DEFAULT_DATA = {
            í˜„ì¬ê³ ê°: '-',
            ì›”ê°„ì´íƒˆ: '-',
            ì¶”ì²œ: '-',
            ì‹ ê·œê³ ê°: '-',
            í™œì„±ê³ ê°: '-',
            ì›”ë°©ë¬¸ì: '-',
            ê´€ì‹¬ê³ ê°: '-',
            ì´íƒˆìœ¨: '-',
            ì¶”ì²œìœ¨: '-',
            ì „í™˜ìœ¨: '-',
            í™•ë³´ìœ¨: '-'
        };

        async function loadFromSheets() {
            try {
                const range = `${SHEET_NAME}!A:L`;
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${range}?key=${API_KEY}`;
                
                console.log('ğŸ“¡ API ìš”ì²­:', url);
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`API ì˜¤ë¥˜ (${response.status})`);
                }
                
                const data = await response.json();
                console.log('ğŸ“¥ ë°›ì€ ë°ì´í„°:', data);
                
                if (!data.values || data.values.length < 2) {
                    throw new Error('ë°ì´í„°ê°€ ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (ìµœì†Œ 2í–‰ í•„ìš”)');
                }

                const headers = data.values[0];
                
                // í˜„ì¬ ë°ì´í„° (2ë²ˆì§¸ í–‰, index 1)
                const currentRow = data.values[1];
                
                // ì´ì „ ë°ì´í„° (3ë²ˆì§¸ í–‰, index 2) - ìˆìœ¼ë©´ ê°€ì ¸ì˜¤ê¸°
                const previousRow = data.values.length > 2 ? data.values[2] : null;
                
                console.log('ğŸ“‹ í—¤ë”:', headers);
                console.log('ğŸ“Š í˜„ì¬ ë°ì´í„°:', currentRow);
                console.log('ğŸ“Š ì´ì „ ë°ì´í„°:', previousRow);
                
                // í˜„ì¬ ë°ì´í„° íŒŒì‹±
                const currentData = {};
                headers.forEach((header, idx) => {
                    currentData[header] = currentRow[idx] || '0';
                });

                // ì´ì „ ë°ì´í„° íŒŒì‹± (ìˆëŠ” ê²½ìš°)
                let previousData = null;
                if (previousRow) {
                    previousData = {};
                    headers.forEach((header, idx) => {
                        previousData[header] = previousRow[idx] || '0';
                    });
                }

                console.log('ğŸ—ºï¸ í˜„ì¬ ë°ì´í„° ë§¤í•‘:', currentData);
                console.log('ğŸ—ºï¸ ì´ì „ ë°ì´í„° ë§¤í•‘:', previousData);

                // í˜„ì¬ ê°’ë“¤ ì¶”ì¶œ
                const ë‚ ì§œ = currentData['ë‚ ì§œ'] || '-';
                const í˜„ì¬ê³ ê° = parseInt(currentData['í˜„ì¬ê³ ê°']) || 0;
                const ì›”ê°„ì´íƒˆ = parseInt(currentData['ì›”ê°„ì´íƒˆ']) || 0;
                const ì¶”ì²œ = parseInt(currentData['ì¶”ì²œ']) || 0;
                const ì‹ ê·œê³ ê° = parseInt(currentData['ì‹ ê·œê³ ê°']) || 0;
                const í™œì„±ê³ ê° = parseInt(currentData['í™œì„±ê³ ê°']) || 0;
                const ì›”ë°©ë¬¸ì = parseInt(currentData['ì›”ë°©ë¬¸ì']) || 0;
                const ê´€ì‹¬ê³ ê° = parseInt(currentData['ê´€ì‹¬ê³ ê°']) || 0;
                
                // ì´ì „ ê°’ë“¤ ì¶”ì¶œ (ìˆëŠ” ê²½ìš°)
                let comparison = null;
                if (previousData) {
                    const ì´ì „_í˜„ì¬ê³ ê° = parseInt(previousData['í˜„ì¬ê³ ê°']) || 0;
                    const ì´ì „_ì›”ê°„ì´íƒˆ = parseInt(previousData['ì›”ê°„ì´íƒˆ']) || 0;
                    const ì´ì „_ì¶”ì²œ = parseInt(previousData['ì¶”ì²œ']) || 0;
                    const ì´ì „_ì‹ ê·œê³ ê° = parseInt(previousData['ì‹ ê·œê³ ê°']) || 0;
                    const ì´ì „_í™œì„±ê³ ê° = parseInt(previousData['í™œì„±ê³ ê°']) || 0;
                    const ì´ì „_ì›”ë°©ë¬¸ì = parseInt(previousData['ì›”ë°©ë¬¸ì']) || 0;
                    const ì´ì „_ê´€ì‹¬ê³ ê° = parseInt(previousData['ê´€ì‹¬ê³ ê°']) || 0;
                    
                    comparison = {
                        í˜„ì¬ê³ ê°: calculateChange(í˜„ì¬ê³ ê°, ì´ì „_í˜„ì¬ê³ ê°),
                        ì›”ê°„ì´íƒˆ: calculateChange(ì›”ê°„ì´íƒˆ, ì´ì „_ì›”ê°„ì´íƒˆ),
                        ì¶”ì²œ: calculateChange(ì¶”ì²œ, ì´ì „_ì¶”ì²œ),
                        ì‹ ê·œê³ ê°: calculateChange(ì‹ ê·œê³ ê°, ì´ì „_ì‹ ê·œê³ ê°),
                        í™œì„±ê³ ê°: calculateChange(í™œì„±ê³ ê°, ì´ì „_í™œì„±ê³ ê°),
                        ì›”ë°©ë¬¸ì: calculateChange(ì›”ë°©ë¬¸ì, ì´ì „_ì›”ë°©ë¬¸ì),
                        ê´€ì‹¬ê³ ê°: calculateChange(ê´€ì‹¬ê³ ê°, ì´ì „_ê´€ì‹¬ê³ ê°)
                    };
                    
                    console.log('ğŸ“ˆ ë³€í™”ëŸ‰ ê³„ì‚°:', comparison);
                }

                // ë‚ ì§œ í‘œì‹œ
                document.getElementById('date-value').textContent = ë‚ ì§œ;
                document.getElementById('date-header').style.display = 'block';

                // ê³„ì‚°ëœ ë¹„ìœ¨
                const ì´íƒˆìœ¨ = í˜„ì¬ê³ ê° > 0 ? ((ì›”ê°„ì´íƒˆ / í˜„ì¬ê³ ê°) * 100).toFixed(1) : '0.0';
                const ì¶”ì²œìœ¨ = ì‹ ê·œê³ ê° > 0 ? ((ì¶”ì²œ / ì‹ ê·œê³ ê°) * 100).toFixed(0) : '0';
                const ì „í™˜ìœ¨ = ê´€ì‹¬ê³ ê° > 0 ? ((ì‹ ê·œê³ ê° / ê´€ì‹¬ê³ ê°) * 100).toFixed(0) : '0';
                const í™•ë³´ìœ¨ = ì›”ë°©ë¬¸ì > 0 ? ((ê´€ì‹¬ê³ ê° / ì›”ë°©ë¬¸ì) * 100).toFixed(0) : '0';

                console.log('ğŸ“ˆ ê³„ì‚°ëœ ë¹„ìœ¨:', { ì´íƒˆìœ¨, ì¶”ì²œìœ¨, ì „í™˜ìœ¨, í™•ë³´ìœ¨ });

                const displayData = {
                    í˜„ì¬ê³ ê°: í˜„ì¬ê³ ê°.toLocaleString(),
                    ì›”ê°„ì´íƒˆ: ì›”ê°„ì´íƒˆ.toLocaleString(),
                    ì¶”ì²œ: ì¶”ì²œ.toLocaleString(),
                    ì‹ ê·œê³ ê°: ì‹ ê·œê³ ê°.toLocaleString(),
                    í™œì„±ê³ ê°: í™œì„±ê³ ê°.toLocaleString(),
                    ì›”ë°©ë¬¸ì: ì›”ë°©ë¬¸ì.toLocaleString(),
                    ê´€ì‹¬ê³ ê°: ê´€ì‹¬ê³ ê°.toLocaleString(),
                    ì´íƒˆìœ¨,
                    ì¶”ì²œìœ¨,
                    ì „í™˜ìœ¨,
                    í™•ë³´ìœ¨,
                    comparison
                };

                console.log('âœ… ìµœì¢… í‘œì‹œ ë°ì´í„°:', displayData);

                drawDiagram(displayData);

                // ë¡œë”© ì˜¤ë²„ë ˆì´ ì œê±°
                document.getElementById('loading-overlay').style.display = 'none';
                
            } catch (error) {
                console.error('âŒ ì˜¤ë¥˜ ë°œìƒ:', error);
                
                // ê¸°ë³¸ê°’ìœ¼ë¡œ ë‹¤ì´ì–´ê·¸ë¨ í‘œì‹œ
                drawDiagram(DEFAULT_DATA);
                
                // ë¡œë”© ì˜¤ë²„ë ˆì´ ì œê±°
                document.getElementById('loading-overlay').style.display = 'none';
                
                // ì—ëŸ¬ ë©”ì‹œì§€ í•˜ë‹¨ í‘œì‹œ
                const errorEl = document.getElementById('error-message');
                errorEl.innerHTML = `<strong>âš ï¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:</strong> ${error.message}`;
                errorEl.classList.add('show');
            }
        }

        function calculateChange(current, previous) {
            if (!previous || previous === 0) return null;
            const change = current - previous;
            const percentage = ((change / previous) * 100).toFixed(1);
            return {
                change,
                percentage,
                isIncrease: change > 0
            };
        }

        function renderComparison(key, x, y) {
            const comp = window.currentComparison?.[key];
            if (!comp) return '';
            
            const arrow = comp.isIncrease ? 'â–²' : 'â–¼';
            const className = comp.isIncrease ? 'comparison-increase' : 'comparison-decrease';
            const sign = comp.isIncrease ? '+' : '';
            
            return `<text x="${x}" y="${y}" class="comparison-text ${className}">${arrow} ${sign}${comp.change} (${sign}${comp.percentage}%)</text>`;
        }

        function drawDiagram(data) {
            console.log('ğŸ¨ ë‹¤ì´ì–´ê·¸ë¨ ê·¸ë¦¬ê¸° ì‹œì‘:', data);
            
            // ë¹„êµ ë°ì´í„°ë¥¼ ì „ì—­ìœ¼ë¡œ ì €ì¥
            window.currentComparison = data.comparison;
            
            const container = document.getElementById('diagram-container');
            
            const svg = `
<svg viewBox="0 0 1070 420" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet">
    <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
            <polygon points="0 0, 10 3, 0 6" fill="#6c757d" />
        </marker>
        <marker id="arrowhead-return" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
            <polygon points="0 0, 10 3, 0 6" fill="#e53e3e" />
        </marker>
    </defs>
    
    <!-- ìƒë‹¨ íë¦„ (5ê°œ ë…¸ë“œ) -->
    
    <!-- í˜„ì¬ ê³ ê° -->
    <rect x="30" y="30" width="150" height="90" class="node-box"/>
    <text x="105" y="55" class="node-text-title">í˜„ì¬ ê³ ê°</text>
    <text x="105" y="85" class="node-text-value">${data.í˜„ì¬ê³ ê°}ëª…</text>
    ${renderComparison('í˜„ì¬ê³ ê°', 105, 108)}
    
    <!-- í™”ì‚´í‘œ: í˜„ì¬ ê³ ê° â†’ ì›”ê°„ ì´íƒˆ -->
    <line x1="180" y1="75" x2="245" y2="75" class="arrow"/>
    <text x="213" y="65" class="arrow-label">-</text>
    
    <!-- ì›”ê°„ ì´íƒˆ -->
    <rect x="245" y="30" width="150" height="90" class="node-box"/>
    <text x="320" y="55" class="node-text-title">ì›”ê°„ ì´íƒˆ</text>
    <text x="320" y="85" class="node-text-value">${data.ì›”ê°„ì´íƒˆ}ëª…</text>
    ${renderComparison('ì›”ê°„ì´íƒˆ', 320, 108)}
    
    <!-- í™”ì‚´í‘œ: ì›”ê°„ ì´íƒˆ â†’ ì¶”ì²œ -->
    <line x1="395" y1="75" x2="460" y2="75" class="arrow"/>
    <text x="428" y="65" class="arrow-label">+</text>
    
    <!-- ì¶”ì²œ -->
    <rect x="460" y="30" width="150" height="90" class="node-box"/>
    <text x="535" y="55" class="node-text-title">ì¶”ì²œ</text>
    <text x="535" y="85" class="node-text-value">${data.ì¶”ì²œ}ëª…</text>
    ${renderComparison('ì¶”ì²œ', 535, 108)}
    
    <!-- í™”ì‚´í‘œ: ì¶”ì²œ â†’ ì‹ ê·œ ê³ ê° -->
    <line x1="610" y1="75" x2="675" y2="75" class="arrow"/>
    <text x="643" y="65" class="arrow-label">+</text>
    
    <!-- ì‹ ê·œ ê³ ê° -->
    <rect x="675" y="30" width="150" height="90" class="node-box"/>
    <text x="750" y="55" class="node-text-title">ì‹ ê·œ ê³ ê°</text>
    <text x="750" y="85" class="node-text-value">${data.ì‹ ê·œê³ ê°}ëª…</text>
    ${renderComparison('ì‹ ê·œê³ ê°', 750, 108)}
    
    <!-- í™”ì‚´í‘œ: ì‹ ê·œ ê³ ê° â†’ í™œì„± ê³ ê° -->
    <line x1="825" y1="75" x2="890" y2="75" class="arrow"/>
    <text x="858" y="65" class="arrow-label">=</text>
    
    <!-- í™œì„± ê³ ê° -->
    <rect x="890" y="30" width="150" height="90" class="node-box"/>
    <text x="965" y="55" class="node-text-title">í™œì„± ê³ ê°</text>
    <text x="965" y="85" class="node-text-value">${data.í™œì„±ê³ ê°}ëª…</text>
    ${renderComparison('í™œì„±ê³ ê°', 965, 108)}
    
    <!-- í•˜ë‹¨ íë¦„ -->
    
    <!-- ì›” ë°©ë¬¸ì -->
    <rect x="30" y="270" width="150" height="90" class="node-box"/>
    <text x="105" y="295" class="node-text-title">ì›” ë°©ë¬¸ì</text>
    <text x="105" y="325" class="node-text-value">${data.ì›”ë°©ë¬¸ì}ëª…</text>
    ${renderComparison('ì›”ë°©ë¬¸ì', 105, 348)}
    
    <!-- í™”ì‚´í‘œ: ì›” ë°©ë¬¸ì â†’ ì†”ë£¨ì…˜ -->
    <line x1="180" y1="315" x2="295" y2="315" class="arrow"/>
    <text x="238" y="305" class="rate-label">í™•ë³´ ${data.í™•ë³´ìœ¨}%</text>
    
    <!-- ì†”ë£¨ì…˜ (ìœ¡ê°í˜•) -->
    <polygon points="350,285 420,285 450,315 420,345 350,345 320,315" class="node-factory"/>
    <text x="385" y="310" class="node-text-title">ì†”ë£¨ì…˜</text>
    <text x="385" y="330" class="node-text-title">(ê³µì¥)</text>
    
    <!-- í™”ì‚´í‘œ: ì†”ë£¨ì…˜ â†’ ê´€ì‹¬ ê³ ê° (í™œì„±í™”) -->
    <line x1="450" y1="315" x2="565" y2="315" class="arrow"/>
    <text x="507" y="305" class="rate-label">í™œì„±í™”</text>
    
    <!-- ê´€ì‹¬ ê³ ê° -->
    <rect x="565" y="270" width="150" height="90" class="node-box"/>
    <text x="640" y="295" class="node-text-title">ê´€ì‹¬ ê³ ê°</text>
    <text x="640" y="325" class="node-text-value">${data.ê´€ì‹¬ê³ ê°}ëª…</text>
    ${renderComparison('ê´€ì‹¬ê³ ê°', 640, 348)}
    
    <!-- ì—­ë°©í–¥ í™”ì‚´í‘œ: ê´€ì‹¬ ê³ ê° â†’ ì†”ë£¨ì…˜ (ìœ ì§€) - ì•„ë˜ìª½ -->
    <path d="M 565 340 Q 507 355 450 340" class="arrow-return"/>
    <text x="507" y="370" class="rate-label" style="fill: #e53e3e;">ìœ ì§€</text>
    
    <!-- í”¼ë“œë°± ë£¨í”„ë“¤ (ê³¡ì„  í™”ì‚´í‘œ) -->
    
    <!-- ì†”ë£¨ì…˜ â†’ ì›”ê°„ ì´íƒˆ -->
    <path d="M 385 285 Q 320 200 320 120" class="arrow-curved"/>
    <text x="340" y="190" class="rate-label">ì´íƒˆ ${data.ì´íƒˆìœ¨}%</text>
    
    <!-- ì†”ë£¨ì…˜ â†’ ì¶”ì²œ -->
    <path d="M 385 285 Q 460 200 535 120" class="arrow-curved"/>
    <text x="450" y="190" class="rate-label">ì¶”ì²œ ${data.ì¶”ì²œìœ¨}%</text>
    
    <!-- ê´€ì‹¬ ê³ ê° â†’ ì‹ ê·œ ê³ ê° -->
    <path d="M 640 270 Q 750 190 750 120" class="arrow-curved"/>
    <text x="720" y="185" class="rate-label">ì „í™˜ ${data.ì „í™˜ìœ¨}%</text>
</svg>
            `;
            
            // ê¸°ì¡´ SVGê°€ ìˆìœ¼ë©´ êµì²´, ì—†ìœ¼ë©´ ì¶”ê°€
            const existingSvg = container.querySelector('svg');
            if (existingSvg) {
                existingSvg.outerHTML = svg;
            } else {
                container.innerHTML = svg + container.innerHTML;
            }
            
            console.log('âœ… ë‹¤ì´ì–´ê·¸ë¨ ë Œë”ë§ ì™„ë£Œ');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        window.addEventListener('load', () => {
            console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ, ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹œì‘');
            loadFromSheets();
        });
    </script>
</body>
</html>