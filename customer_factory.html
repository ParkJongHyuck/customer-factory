<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ê³ ê° ê³µì¥ ë‹¤ì´ì–´ê·¸ë¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: white;
        }

        .wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .date-header {
            text-align: center;
            margin-top: 20px;
            margin-bottom: 15px;
        }

        .date-label {
            font-size: 16px;
            color: #6c757d;
            font-weight: 600;
            margin-right: 6px;
        }

        .date-value {
            font-size: 16px;
            color: #212529;
            font-weight: 700;
            max-width: 800px;
            display: inline-block;
        }
        
        .diagram-container {
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        .loading {
            text-align: center;
            color: #6c757d;
            font-size: 16px;
        }

        .error-message {
            display: none;
        }

        svg {
            width: 100%;
            height: auto;
        }

        .node-box {
            fill: white;
            stroke: #6c757d;
            stroke-width: 2;
            rx: 20;
        }

        .node-box-highlight {
            fill: #e8f4f8;
            stroke: #4a90e2;
            stroke-width: 2;
            rx: 20;
        }

        .node-factory {
            fill: #fff9e6;
            stroke: #f39c12;
            stroke-width: 3;
        }

        .node-box-h5 {
            fill: #f8f9fa;
            stroke: #adb5bd;
            stroke-width: 2;
            rx: 15;
        }

        .node-text-title {
            font-size: 16px;
            font-weight: 600;
            fill: #495057;
            text-anchor: middle;
        }

        .node-text-value {
            font-size: 18px;
            font-weight: 700;
            fill: #212529;
            text-anchor: middle;
        }

        .node-text-title-h5 {
            font-size: 14px;
            font-weight: 600;
            fill: #6c757d;
            text-anchor: middle;
        }

        .node-text-value-h5 {
            font-size: 16px;
            font-weight: 700;
            fill: #495057;
            text-anchor: middle;
        }

        .comparison-text {
            font-size: 16px;
            font-weight: 600;
            text-anchor: middle;
        }

        .comparison-increase {
            fill: #28a745;
        }

        .comparison-decrease {
            fill: #dc3545;
        }

        .arrow {
            stroke: #6c757d;
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead);
        }

        .arrow-curved {
            stroke: #6c757d;
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead);
        }

        .arrow-feedback {
            stroke-width: 2.5;
            fill: none;
        }

        .arrow-churn {
            stroke: #e74c3c;
            marker-end: url(#arrowhead-churn);
        }

        .arrow-referral {
            stroke: #9b59b6;
            marker-end: url(#arrowhead-referral);
        }

        .arrow-conversion {
            stroke: #14a085;
            marker-end: url(#arrowhead-conversion);
        }

        .arrow-return {
            stroke: #6c757d;
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead);
        }

        .arrow-h5 {
            stroke: #adb5bd;
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead-h5);
        }

        .arrow-h5-up {
            stroke: #adb5bd;
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead-h5);
        }

        .arrow-label {
            font-size: 16px;
            fill: #6c757d;
            text-anchor: middle;
        }

        .rate-label {
            font-size: 16px;
            fill: #6c757d;
            text-anchor: middle;
        }

        .rate-box {
            rx: 8;
            ry: 8;
        }

        .rate-box-churn {
            fill: #ffe6e6;
            stroke: #e74c3c;
            stroke-width: 1.5;
        }

        .rate-box-referral {
            fill: #f3e5f5;
            stroke: #9b59b6;
            stroke-width: 1.5;
        }

        .rate-box-conversion {
            fill: #e0f7f7;
            stroke: #14a085;
            stroke-width: 1.5;
        }

        .rate-box-acquisition {
            fill: #e8f8f5;
            stroke: #27ae60;
            stroke-width: 1.5;
        }

        .rate-box-activation {
            fill: #e3f2fd;
            stroke: #2196f3;
            stroke-width: 1.5;
        }

        .rate-text-churn {
            fill: #c0392b;
            font-size: 16px;
            font-weight: 600;
            text-anchor: middle;
        }

        .rate-text-referral {
            fill: #7d3c98;
            font-size: 16px;
            font-weight: 600;
            text-anchor: middle;
        }

        .rate-text-conversion {
            fill: #0d7377;
            font-size: 16px;
            font-weight: 600;
            text-anchor: middle;
        }

        .rate-text-acquisition {
            fill: #1e8449;
            font-size: 16px;
            font-weight: 600;
            text-anchor: middle;
        }

        .rate-text-activation {
            fill: #1565c0;
            font-size: 16px;
            font-weight: 600;
            text-anchor: middle;
        }
    </style>
</head>
<body>
    <div class="wrapper">
        <div class="date-header" id="date-header">
            <span class="date-label">ê³ ê° ê³µì¥:</span>
            <span class="date-value" id="date-value">ë¡œë”© ì¤‘...</span>
        </div>
        <div class="diagram-container" id="diagram-container">
            <div class="loading-overlay" id="loading-overlay">
                <div class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</div>
            </div>
        </div>
        <div class="error-message" id="error-message"></div>
    </div>

    <script>
        // í•˜ë“œì½”ë”©ëœ ì„¤ì •ê°’
        const SHEET_ID = '1Up0FHYHBlYzZhdDvcVBe9xHZWVxefUQNg5CRgXlzZbE';
        const API_KEY = 'AIzaSyCtgQLWJiGP1c4GfY-gLXBnIZNZH71XMVc';
        const SHEET_NAME = '2026';

        // ê¸°ë³¸ê°’ (ì—ëŸ¬ ì‹œ ì‚¬ìš©)
        const DEFAULT_DATA = {
            ëˆ„ì ê³ ê°: '-',
            ì´íƒˆ: '-',
            ì¶”ì²œ: '-',
            ì‹ ê·œê³ ê°: '-',
            í™œì„±ê³ ê°: '-',
            ë°©ë¬¸ì: '-',
            ì ì¬ê³ ê°: '-',
            ê´€ì‹¬ê³ ê°: '-',
            ì´íƒˆìœ¨: '-',
            ì¶”ì²œìœ¨: '-',
            ì „í™˜ìœ¨: '-',
            í™•ë³´ìœ¨: '-',
            í™œì„±í™”ìœ¨: '-',
            í”Œë ˆì´: '-',
            í¬ìŠ¤íŠ¸: '-',
            ìº í˜ì¸: '-',
            í”Œë ˆì´ì „í™˜ìœ¨: '-',
            í¬ìŠ¤íŠ¸ì „í™˜ìœ¨: '-',
            ìº í˜ì¸ì „í™˜ìœ¨: '-'
        };

        // URL íŒŒë¼ë¯¸í„°ì—ì„œ ë‚ ì§œ ê°€ì ¸ì˜¤ê¸°
        function getDateFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const dateParam = urlParams.get('date');
            console.log('ğŸ“… URL íŒŒë¼ë¯¸í„° ë‚ ì§œ:', dateParam);
            return dateParam;
        }

        // ë‚ ì§œë¡œ ë°ì´í„° í–‰ ì°¾ê¸°
        function findRowByDate(data, targetDate) {
            if (!targetDate || !data.values || data.values.length < 2) {
                return null;
            }

            const headers = data.values[0];
            const dateIndex = headers.indexOf('ë‚ ì§œ');
            
            if (dateIndex === -1) {
                console.log('âš ï¸ ë‚ ì§œ ì»¬ëŸ¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                return null;
            }

            // 1ë²ˆ ì¸ë±ìŠ¤ë¶€í„° ê²€ìƒ‰ (í—¤ë” ì œì™¸)
            for (let i = 1; i < data.values.length; i++) {
                const row = data.values[i];
                const rowDate = row[dateIndex];
                
                if (rowDate === targetDate) {
                    console.log(`âœ… ë‚ ì§œ "${targetDate}" ë°œê²¬: í–‰ ${i + 1}`);
                    return {
                        currentIndex: i,
                        previousIndex: i + 1 < data.values.length ? i + 1 : null
                    };
                }
            }

            console.log(`âš ï¸ ë‚ ì§œ "${targetDate}"ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤`);
            return null;
        }

        async function loadFromSheets() {
            try {
                const range = `${SHEET_NAME}!A:O`;
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${range}?key=${API_KEY}`;
                
                console.log('ğŸ“¡ API ìš”ì²­:', url);
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`API ì˜¤ë¥˜ (${response.status})`);
                }
                
                const data = await response.json();
                console.log('ğŸ“¥ ë°›ì€ ë°ì´í„°:', data);
                
                if (!data.values || data.values.length < 2) {
                    throw new Error('ë°ì´í„°ê°€ ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (ìµœì†Œ 2í–‰ í•„ìš”)');
                }

                const headers = data.values[0];
                
                // URL íŒŒë¼ë¯¸í„°ì—ì„œ ë‚ ì§œ í™•ì¸
                const targetDate = getDateFromURL();
                let currentRowIndex = 1;
                let previousRowIndex = 2;

                if (targetDate) {
                    const foundIndices = findRowByDate(data, targetDate);
                    if (foundIndices) {
                        currentRowIndex = foundIndices.currentIndex;
                        previousRowIndex = foundIndices.previousIndex;
                    } else {
                        // ë‚ ì§œë¥¼ ì°¾ì§€ ëª»í•˜ë©´ ê¸°ë³¸ê°’(ìµœì‹  ë°ì´í„°) ì‚¬ìš©
                        console.log('âš ï¸ ì§€ì •ëœ ë‚ ì§œë¥¼ ì°¾ì§€ ëª»í•´ ìµœì‹  ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤');
                    }
                }
                
                // í˜„ì¬ ë°ì´í„°
                const currentRow = data.values[currentRowIndex];
                
                // ì´ì „ ë°ì´í„° (ìˆìœ¼ë©´ ê°€ì ¸ì˜¤ê¸°)
                const previousRow = previousRowIndex && data.values.length > previousRowIndex 
                    ? data.values[previousRowIndex] 
                    : null;
                
                console.log('ğŸ“‹ í—¤ë”:', headers);
                console.log('ğŸ“Š í˜„ì¬ ë°ì´í„°:', currentRow);
                console.log('ğŸ“Š ì´ì „ ë°ì´í„°:', previousRow);
                
                // í˜„ì¬ ë°ì´í„° íŒŒì‹±
                const currentData = {};
                headers.forEach((header, idx) => {
                    currentData[header] = currentRow[idx] || '0';
                });

                // ì´ì „ ë°ì´í„° íŒŒì‹± (ìˆëŠ” ê²½ìš°)
                let previousData = null;
                if (previousRow) {
                    previousData = {};
                    headers.forEach((header, idx) => {
                        previousData[header] = previousRow[idx] || '0';
                    });
                }

                console.log('ğŸ—ºï¸ í˜„ì¬ ë°ì´í„° ë§¤í•‘:', currentData);
                console.log('ğŸ—ºï¸ ì´ì „ ë°ì´í„° ë§¤í•‘:', previousData);

                // í˜„ì¬ ê°’ë“¤ ì¶”ì¶œ
                const ë‚ ì§œ = currentData['ë‚ ì§œ'] || '-';
                const ëˆ„ì ê³ ê° = parseInt(currentData['ëˆ„ì ê³ ê°']) || 0;
                const ì´íƒˆ = parseInt(currentData['ì´íƒˆ']) || 0;
                const ì¶”ì²œ = parseInt(currentData['ì¶”ì²œ']) || 0;
                const ì‹ ê·œê³ ê° = parseInt(currentData['ì‹ ê·œê³ ê°']) || 0;
                const í™œì„±ê³ ê° = parseInt(currentData['í™œì„±ê³ ê°']) || 0;
                const ë°©ë¬¸ì = parseInt(currentData['ë°©ë¬¸ì']) || 0;
                const ì ì¬ê³ ê° = parseInt(currentData['ì ì¬ê³ ê°']) || 0;
                const ê´€ì‹¬ê³ ê° = parseInt(currentData['ê´€ì‹¬ê³ ê°']) || 0;
                const í”Œë ˆì´ = parseInt(currentData['í”Œë ˆì´']) || 0;
                const í¬ìŠ¤íŠ¸ = parseInt(currentData['í¬ìŠ¤íŠ¸']) || 0;
                const ìº í˜ì¸ = parseInt(currentData['ìº í˜ì¸']) || 0;
                
                // ì´ì „ ê°’ë“¤ ì¶”ì¶œ (ìˆëŠ” ê²½ìš°)
                let comparison = null;
                if (previousData) {
                    const ì´ì „_ëˆ„ì ê³ ê° = parseInt(previousData['ëˆ„ì ê³ ê°']) || 0;
                    const ì´ì „_ì´íƒˆ = parseInt(previousData['ì´íƒˆ']) || 0;
                    const ì´ì „_ì¶”ì²œ = parseInt(previousData['ì¶”ì²œ']) || 0;
                    const ì´ì „_ì‹ ê·œê³ ê° = parseInt(previousData['ì‹ ê·œê³ ê°']) || 0;
                    const ì´ì „_í™œì„±ê³ ê° = parseInt(previousData['í™œì„±ê³ ê°']) || 0;
                    const ì´ì „_ë°©ë¬¸ì = parseInt(previousData['ë°©ë¬¸ì']) || 0;
                    const ì´ì „_ì ì¬ê³ ê° = parseInt(previousData['ì ì¬ê³ ê°']) || 0;
                    const ì´ì „_ê´€ì‹¬ê³ ê° = parseInt(previousData['ê´€ì‹¬ê³ ê°']) || 0;
                    const ì´ì „_í”Œë ˆì´ = parseInt(previousData['í”Œë ˆì´']) || 0;
                    const ì´ì „_í¬ìŠ¤íŠ¸ = parseInt(previousData['í¬ìŠ¤íŠ¸']) || 0;
                    const ì´ì „_ìº í˜ì¸ = parseInt(previousData['ìº í˜ì¸']) || 0;
                    
                    comparison = {
                        ëˆ„ì ê³ ê°: calculateChange(ëˆ„ì ê³ ê°, ì´ì „_ëˆ„ì ê³ ê°),
                        ì´íƒˆ: calculateChange(ì´íƒˆ, ì´ì „_ì´íƒˆ),
                        ì¶”ì²œ: calculateChange(ì¶”ì²œ, ì´ì „_ì¶”ì²œ),
                        ì‹ ê·œê³ ê°: calculateChange(ì‹ ê·œê³ ê°, ì´ì „_ì‹ ê·œê³ ê°),
                        í™œì„±ê³ ê°: calculateChange(í™œì„±ê³ ê°, ì´ì „_í™œì„±ê³ ê°),
                        ë°©ë¬¸ì: calculateChange(ë°©ë¬¸ì, ì´ì „_ë°©ë¬¸ì),
                        ì ì¬ê³ ê°: calculateChange(ì ì¬ê³ ê°, ì´ì „_ì ì¬ê³ ê°),
                        ê´€ì‹¬ê³ ê°: calculateChange(ê´€ì‹¬ê³ ê°, ì´ì „_ê´€ì‹¬ê³ ê°),
                        í”Œë ˆì´: calculateChange(í”Œë ˆì´, ì´ì „_í”Œë ˆì´),
                        í¬ìŠ¤íŠ¸: calculateChange(í¬ìŠ¤íŠ¸, ì´ì „_í¬ìŠ¤íŠ¸),
                        ìº í˜ì¸: calculateChange(ìº í˜ì¸, ì´ì „_ìº í˜ì¸)
                    };
                    
                    console.log('ğŸ“ˆ ë³€í™”ëŸ‰ ê³„ì‚°:', comparison);
                }

                // ë‚ ì§œ í‘œì‹œ - í•­ìƒ í‘œì‹œ
                const ë‚ ì§œí‘œì‹œ = ë‚ ì§œ || 'ë°ì´í„° ì—†ìŒ';
                document.getElementById('date-value').textContent = ë‚ ì§œí‘œì‹œ;

                // ê³„ì‚°ëœ ë¹„ìœ¨
                const ì´íƒˆìœ¨ = ëˆ„ì ê³ ê° > 0 ? ((ì´íƒˆ / ëˆ„ì ê³ ê°) * 100).toFixed(1) : '0.0';
                const ì¶”ì²œìœ¨ = ì‹ ê·œê³ ê° > 0 ? ((ì¶”ì²œ / ì‹ ê·œê³ ê°) * 100).toFixed(0) : '0';
                const ì „í™˜ìœ¨ = ê´€ì‹¬ê³ ê° > 0 ? ((ì‹ ê·œê³ ê° / ê´€ì‹¬ê³ ê°) * 100).toFixed(0) : '0';
                const í™•ë³´ìœ¨ = ë°©ë¬¸ì > 0 ? ((ì ì¬ê³ ê° / ë°©ë¬¸ì) * 100).toFixed(0) : '0';
                const í™œì„±í™”ìœ¨ = ì ì¬ê³ ê° > 0 ? ((ê´€ì‹¬ê³ ê° / ì ì¬ê³ ê°) * 100).toFixed(0) : '0';
                
                // h5 ì „í™˜ìœ¨ ê³„ì‚°
                const í”Œë ˆì´ì „í™˜ìœ¨ = ì ì¬ê³ ê° > 0 ? ((í”Œë ˆì´ / ì ì¬ê³ ê°) * 100).toFixed(1) : '0.0';
                const í¬ìŠ¤íŠ¸ì „í™˜ìœ¨ = í”Œë ˆì´ > 0 ? ((í¬ìŠ¤íŠ¸ / í”Œë ˆì´) * 100).toFixed(1) : '0.0';
                const ìº í˜ì¸ì „í™˜ìœ¨ = í¬ìŠ¤íŠ¸ > 0 ? ((ìº í˜ì¸ / í¬ìŠ¤íŠ¸) * 100).toFixed(1) : '0.0';

                console.log('ğŸ“ˆ ê³„ì‚°ëœ ë¹„ìœ¨:', { ì´íƒˆìœ¨, ì¶”ì²œìœ¨, ì „í™˜ìœ¨, í™•ë³´ìœ¨, í™œì„±í™”ìœ¨, í”Œë ˆì´ì „í™˜ìœ¨, í¬ìŠ¤íŠ¸ì „í™˜ìœ¨, ìº í˜ì¸ì „í™˜ìœ¨ });

                const displayData = {
                    ëˆ„ì ê³ ê°: ëˆ„ì ê³ ê°.toLocaleString(),
                    ì´íƒˆ: ì´íƒˆ.toLocaleString(),
                    ì¶”ì²œ: ì¶”ì²œ.toLocaleString(),
                    ì‹ ê·œê³ ê°: ì‹ ê·œê³ ê°.toLocaleString(),
                    í™œì„±ê³ ê°: í™œì„±ê³ ê°.toLocaleString(),
                    ë°©ë¬¸ì: ë°©ë¬¸ì.toLocaleString(),
                    ì ì¬ê³ ê°: ì ì¬ê³ ê°.toLocaleString(),
                    ê´€ì‹¬ê³ ê°: ê´€ì‹¬ê³ ê°.toLocaleString(),
                    í”Œë ˆì´: í”Œë ˆì´.toLocaleString(),
                    í¬ìŠ¤íŠ¸: í¬ìŠ¤íŠ¸.toLocaleString(),
                    ìº í˜ì¸: ìº í˜ì¸.toLocaleString(),
                    ì´íƒˆìœ¨,
                    ì¶”ì²œìœ¨,
                    ì „í™˜ìœ¨,
                    í™•ë³´ìœ¨,
                    í™œì„±í™”ìœ¨,
                    í”Œë ˆì´ì „í™˜ìœ¨,
                    í¬ìŠ¤íŠ¸ì „í™˜ìœ¨,
                    ìº í˜ì¸ì „í™˜ìœ¨,
                    comparison
                };

                console.log('âœ… ìµœì¢… í‘œì‹œ ë°ì´í„°:', displayData);

                drawDiagram(displayData);

                // ë¡œë”© ì˜¤ë²„ë ˆì´ ì œê±°
                document.getElementById('loading-overlay').style.display = 'none';
                
            } catch (error) {
                console.error('âŒ ì˜¤ë¥˜ ë°œìƒ:', error);
                
                // ë‚ ì§œ ìœ„ì¹˜ì— ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
                document.getElementById('date-value').textContent = `ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${error.message}`;
                
                // ê¸°ë³¸ê°’ìœ¼ë¡œ ë‹¤ì´ì–´ê·¸ë¨ í‘œì‹œ
                drawDiagram(DEFAULT_DATA);
                
                // ë¡œë”© ì˜¤ë²„ë ˆì´ ì œê±°
                document.getElementById('loading-overlay').style.display = 'none';
            }
        }

        function calculateChange(current, previous) {
            if (!previous || previous === 0) return null;
            const change = current - previous;
            const percentage = ((change / previous) * 100).toFixed(1);
            return {
                change,
                percentage,
                isIncrease: change > 0
            };
        }

        function renderComparison(key, x, y) {
            const comp = window.currentComparison?.[key];
            if (!comp) return '';
            
            const arrow = comp.isIncrease ? 'â–²' : 'â–¼';
            const className = comp.isIncrease ? 'comparison-increase' : 'comparison-decrease';
            const sign = comp.isIncrease ? '+' : '';
            
            return `<text x="${x}" y="${y}" class="comparison-text ${className}">${arrow} ${sign}${comp.change} (${sign}${comp.percentage}%)</text>`;
        }

        function renderComparisonSmall(key, x, y) {
            const comp = window.currentComparison?.[key];
            if (!comp) return '';
            
            const arrow = comp.isIncrease ? 'â–²' : 'â–¼';
            const className = comp.isIncrease ? 'comparison-increase' : 'comparison-decrease';
            const sign = comp.isIncrease ? '+' : '';
            
            return `<text x="${x}" y="${y}" class="comparison-text ${className}" style="font-size: 13px;">${arrow} ${sign}${comp.change} (${sign}${comp.percentage}%)</text>`;
        }

        function drawDiagram(data) {
            console.log('ğŸ¨ ë‹¤ì´ì–´ê·¸ë¨ ê·¸ë¦¬ê¸° ì‹œì‘:', data);
            
            // ë¹„êµ ë°ì´í„°ë¥¼ ì „ì—­ìœ¼ë¡œ ì €ì¥
            window.currentComparison = data.comparison;
            
            const container = document.getElementById('diagram-container');
            
            const svg = `
<svg viewBox="0 0 1070 470" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet">
    <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
            <polygon points="0 0, 10 3, 0 6" fill="#6c757d" />
        </marker>
        <marker id="arrowhead-return" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
            <polygon points="0 0, 10 3, 0 6" fill="#e53e3e" />
        </marker>
        <marker id="arrowhead-churn" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
            <polygon points="0 0, 10 3, 0 6" fill="#e74c3c" />
        </marker>
        <marker id="arrowhead-referral" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
            <polygon points="0 0, 10 3, 0 6" fill="#9b59b6" />
        </marker>
        <marker id="arrowhead-conversion" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
            <polygon points="0 0, 10 3, 0 6" fill="#14a085" />
        </marker>
        <marker id="arrowhead-h5" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
            <polygon points="0 0, 10 3, 0 6" fill="#adb5bd" />
        </marker>
    </defs>
    
    <!-- ìƒë‹¨ íë¦„ (5ê°œ ë…¸ë“œ) - ë†’ì´ ê¸°ì¤€ 1: y=30 -->
    
    <!-- ëˆ„ì  ê³ ê° -->
    <rect x="30" y="30" width="150" height="90" class="node-box"/>
    <text x="105" y="55" class="node-text-title">ëˆ„ì  ê³ ê°</text>
    <text x="105" y="85" class="node-text-value">${data.ëˆ„ì ê³ ê°}ëª…</text>
    ${renderComparison('ëˆ„ì ê³ ê°', 105, 108)}
    
    <!-- í™”ì‚´í‘œ: ëˆ„ì  ê³ ê° â†’ ì´íƒˆ -->
    <line x1="180" y1="75" x2="245" y2="75" class="arrow"/>
    <text x="213" y="65" class="arrow-label">-</text>
    
    <!-- ì´íƒˆ -->
    <rect x="245" y="30" width="150" height="90" class="node-box"/>
    <text x="320" y="55" class="node-text-title">ì´íƒˆ</text>
    <text x="320" y="85" class="node-text-value">${data.ì´íƒˆ}ëª…</text>
    ${renderComparison('ì´íƒˆ', 320, 108)}
    
    <!-- í™”ì‚´í‘œ: ì´íƒˆ â†’ ì¶”ì²œ -->
    <line x1="395" y1="75" x2="460" y2="75" class="arrow"/>
    <text x="428" y="65" class="arrow-label">+</text>
    
    <!-- ì¶”ì²œ - ê· ë“± ì •ë ¬ (ì¤‘ì‹¬ 535) -->
    <rect x="460" y="30" width="150" height="90" class="node-box"/>
    <text x="535" y="55" class="node-text-title">ì¶”ì²œ</text>
    <text x="535" y="85" class="node-text-value">${data.ì¶”ì²œ}ëª…</text>
    ${renderComparison('ì¶”ì²œ', 535, 108)}
    
    <!-- í™”ì‚´í‘œ: ì¶”ì²œ â†’ ì‹ ê·œ ê³ ê° -->
    <line x1="610" y1="75" x2="675" y2="75" class="arrow"/>
    <text x="643" y="65" class="arrow-label">+</text>
    
    <!-- ì‹ ê·œ ê³ ê° (í•µì‹¬ ë…¸ë“œ) -->
    <rect x="675" y="30" width="150" height="90" class="node-box-highlight"/>
    <text x="750" y="55" class="node-text-title">ì‹ ê·œ ê³ ê°</text>
    <text x="750" y="85" class="node-text-value">${data.ì‹ ê·œê³ ê°}ëª…</text>
    ${renderComparison('ì‹ ê·œê³ ê°', 750, 108)}
    
    <!-- í™”ì‚´í‘œ: ì‹ ê·œ ê³ ê° â†’ í™œì„± ê³ ê° -->
    <line x1="825" y1="75" x2="890" y2="75" class="arrow"/>
    <text x="858" y="65" class="arrow-label">=</text>
    
    <!-- í™œì„± ê³ ê° (í•µì‹¬ ë…¸ë“œ) -->
    <rect x="890" y="30" width="150" height="90" class="node-box-highlight"/>
    <text x="965" y="55" class="node-text-title">í™œì„± ê³ ê°</text>
    <text x="965" y="85" class="node-text-value">${data.í™œì„±ê³ ê°}ëª…</text>
    ${renderComparison('í™œì„±ê³ ê°', 965, 108)}
    
    <!-- í•˜ë‹¨ íë¦„ - ë†’ì´ ê¸°ì¤€ 4: y=250 -->
    
    <!-- ë°©ë¬¸ì -->
    <rect x="30" y="250" width="150" height="90" class="node-box"/>
    <text x="105" y="275" class="node-text-title">ë°©ë¬¸ì</text>
    <text x="105" y="305" class="node-text-value">${data.ë°©ë¬¸ì}ëª…</text>
    ${renderComparison('ë°©ë¬¸ì', 105, 328)}
    
    <!-- í™”ì‚´í‘œ: ë°©ë¬¸ì â†’ ì ì¬ê³ ê° -->
    <line x1="180" y1="295" x2="245" y2="295" class="arrow"/>
    
    <!-- í™•ë³´ìœ¨ ë°•ìŠ¤ - ë†’ì´ ê¸°ì¤€ 3: y=215 -->
    <rect x="170" y="215" width="86" height="28" class="rate-box rate-box-acquisition"/>
    <text x="213" y="233" class="rate-text-acquisition">í™•ë³´ ${data.í™•ë³´ìœ¨}%</text>
    
    <!-- ì ì¬ê³ ê° - ì´íƒˆê³¼ xì¶• ì •ë ¬ (ì¤‘ì‹¬ 320) -->
    <rect x="245" y="250" width="150" height="90" class="node-box"/>
    <text x="320" y="275" class="node-text-title">ì ì¬ê³ ê°</text>
    <text x="320" y="305" class="node-text-value">${data.ì ì¬ê³ ê°}ëª…</text>
    ${renderComparison('ì ì¬ê³ ê°', 320, 328)}
    
    <!-- í™”ì‚´í‘œ: ì ì¬ê³ ê° â†’ ì†”ë£¨ì…˜ -->
    <line x1="395" y1="295" x2="470" y2="295" class="arrow"/>
    
    <!-- ì†”ë£¨ì…˜ (ìœ¡ê°í˜•) - ì •í™•í•œ ì¤‘ì‹¬ 535 -->
    <polygon points="495,265 575,265 600,295 575,325 495,325 470,295" class="node-factory"/>
    <text x="535" y="290" class="node-text-title">ì†”ë£¨ì…˜</text>
    <text x="535" y="310" class="node-text-title">(ê³µì¥)</text>
    
    <!-- í™”ì‚´í‘œ: ì†”ë£¨ì…˜ â†’ ê´€ì‹¬ ê³ ê° -->
    <line x1="600" y1="295" x2="675" y2="295" class="arrow"/>
    
    <!-- í™œì„±í™”ìœ¨ ë°•ìŠ¤ - ë†’ì´ ê¸°ì¤€ 3: y=215 -->
    <rect x="588" y="215" width="100" height="28" class="rate-box rate-box-activation"/>
    <text x="638" y="233" class="rate-text-activation">í™œì„±í™” ${data.í™œì„±í™”ìœ¨}%</text>
    
    <!-- ê´€ì‹¬ ê³ ê° (í•µì‹¬ ë…¸ë“œ) - ì‹ ê·œê³ ê°ê³¼ xì¶• ì •ë ¬ -->
    <rect x="675" y="250" width="150" height="90" class="node-box-highlight"/>
    <text x="750" y="275" class="node-text-title">ê´€ì‹¬ ê³ ê°</text>
    <text x="750" y="305" class="node-text-value">${data.ê´€ì‹¬ê³ ê°}ëª…</text>
    ${renderComparison('ê´€ì‹¬ê³ ê°', 750, 328)}
    
    <!-- ì—­ë°©í–¥ í™”ì‚´í‘œ: ê´€ì‹¬ ê³ ê° â†’ ì†”ë£¨ì…˜ (ìœ ì§€) - ì•„ë˜ìª½ -->
    <path d="M 675 320 Q 637 335 600 320" class="arrow-return"/>
    <text x="637" y="352" class="rate-label" style="fill: #6c757d;">ìœ ì§€</text>
    
    <!-- í”¼ë“œë°± ë£¨í”„ë“¤ (ë¶€ë“œëŸ¬ìš´ ì§ê° í™”ì‚´í‘œ) - ë†’ì´ ê¸°ì¤€ 2: y=160 -->
    
    <!-- ì†”ë£¨ì…˜ â†’ ì´íƒˆ (ì´íƒˆ ë°•ìŠ¤ë¥¼ í†µê³¼) -->
    <path d="M 495 265 L 495 172 L 320 172 L 320 120" class="arrow-feedback arrow-churn"/>
    <!-- ì´íƒˆìœ¨ ë°•ìŠ¤ - í™”ì‚´í‘œê°€ í†µê³¼ -->
    <rect x="350" y="159" width="80" height="28" class="rate-box rate-box-churn"/>
    <text x="390" y="177" class="rate-text-churn">ì´íƒˆ ${data.ì´íƒˆìœ¨}%</text>
    
    <!-- ì†”ë£¨ì…˜ â†’ ì¶”ì²œ (ìˆ˜ì§ í™”ì‚´í‘œ) -->
    <path d="M 535 265 L 535 120" class="arrow-feedback arrow-referral"/>
    <!-- ì¶”ì²œìœ¨ ë°•ìŠ¤ -->
    <rect x="495" y="159" width="80" height="28" class="rate-box rate-box-referral"/>
    <text x="535" y="177" class="rate-text-referral">ì¶”ì²œ ${data.ì¶”ì²œìœ¨}%</text>
    
    <!-- ê´€ì‹¬ ê³ ê° â†’ ì‹ ê·œ ê³ ê° (ìˆ˜ì§ í™”ì‚´í‘œ) -->
    <path d="M 750 250 L 750 120" class="arrow-feedback arrow-conversion"/>
    <!-- ì „í™˜ìœ¨ ë°•ìŠ¤ -->
    <rect x="710" y="159" width="80" height="28" class="rate-box rate-box-conversion"/>
    <text x="750" y="177" class="rate-text-conversion">ì „í™˜ ${data.ì „í™˜ìœ¨}%</text>

    <!-- ========== h5 ë ˆë²¨ ë…¸ë“œë“¤ (y=390) ========== -->
    
    <!-- í”Œë ˆì´ ë…¸ë“œ - ì ì¬ê³ ê° xì¶• (ì¤‘ì‹¬ 320) -->
    <rect x="255" y="390" width="130" height="70" class="node-box-h5"/>
    <text x="320" y="415" class="node-text-title-h5">í”Œë ˆì´</text>
    <text x="320" y="440" class="node-text-value-h5">${data.í”Œë ˆì´}íšŒ</text>
    ${renderComparisonSmall('í”Œë ˆì´', 320, 455)}
    
    <!-- í¬ìŠ¤íŠ¸ ë…¸ë“œ - ì†”ë£¨ì…˜ xì¶• (ì¤‘ì‹¬ 535) -->
    <rect x="470" y="390" width="130" height="70" class="node-box-h5"/>
    <text x="535" y="415" class="node-text-title-h5">í¬ìŠ¤íŠ¸</text>
    <text x="535" y="440" class="node-text-value-h5">${data.í¬ìŠ¤íŠ¸}íšŒ</text>
    ${renderComparisonSmall('í¬ìŠ¤íŠ¸', 535, 455)}
    
    <!-- ìº í˜ì¸ ë…¸ë“œ - ê´€ì‹¬ê³ ê° xì¶• (ì¤‘ì‹¬ 750) -->
    <rect x="685" y="390" width="130" height="70" class="node-box-h5"/>
    <text x="750" y="415" class="node-text-title-h5">ìº í˜ì¸</text>
    <text x="750" y="440" class="node-text-value-h5">${data.ìº í˜ì¸}íšŒ</text>
    ${renderComparisonSmall('ìº í˜ì¸', 750, 455)}
    
    <!-- h5 í™”ì‚´í‘œë“¤: ì†”ë£¨ì…˜ â†’ í”Œë ˆì´ â†’ í¬ìŠ¤íŠ¸ â†’ ìº í˜ì¸ -->
    
    <!-- ì†”ë£¨ì…˜ â†’ í”Œë ˆì´ (ì†”ë£¨ì…˜ ì•„ë˜ì—ì„œ í”Œë ˆì´ë¡œ) -->
    <path d="M 495 325 L 495 365 L 320 365 L 320 390" class="arrow-h5"/>
    <text x="407" y="358" class="rate-label" style="font-size: 13px; fill: #6c757d;">${data.í”Œë ˆì´ì „í™˜ìœ¨}%</text>
    
    <!-- í”Œë ˆì´ â†’ í¬ìŠ¤íŠ¸ -->
    <line x1="385" y1="425" x2="470" y2="425" class="arrow-h5"/>
    <text x="427" y="418" class="rate-label" style="font-size: 13px; fill: #6c757d;">${data.í¬ìŠ¤íŠ¸ì „í™˜ìœ¨}%</text>
    
    <!-- í¬ìŠ¤íŠ¸ â†’ ìº í˜ì¸ -->
    <line x1="600" y1="425" x2="685" y2="425" class="arrow-h5"/>
    <text x="642" y="418" class="rate-label" style="font-size: 13px; fill: #6c757d;">${data.ìº í˜ì¸ì „í™˜ìœ¨}%</text>
</svg>
            `;
            
            // ê¸°ì¡´ SVGê°€ ìˆìœ¼ë©´ êµì²´, ì—†ìœ¼ë©´ ì¶”ê°€
            const existingSvg = container.querySelector('svg');
            if (existingSvg) {
                existingSvg.outerHTML = svg;
            } else {
                container.innerHTML = svg + container.innerHTML;
            }
            
            console.log('âœ… ë‹¤ì´ì–´ê·¸ë¨ ë Œë”ë§ ì™„ë£Œ');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        window.addEventListener('load', () => {
            console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ, ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹œì‘');
            loadFromSheets();
        });
    </script>
</body>
</html>
