<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ê³ ê° ê³µì¥ ë‹¤ì´ì–´ê·¸ë¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans KR', sans-serif;
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .diagram-container {
            width: 100%;
            max-width: 1400px;
            height: 400px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        .loading {
            text-align: center;
            color: #6c757d;
            font-size: 14px;
        }

        .error-message {
            width: 100%;
            max-width: 1400px;
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 13px;
            margin-top: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .error-message strong {
            font-weight: 600;
        }

        svg {
            width: 100%;
            height: 100%;
        }

        .node-box {
            fill: white;
            stroke: #6c757d;
            stroke-width: 2;
            rx: 20;
        }

        .node-factory {
            fill: white;
            stroke: #6c757d;
            stroke-width: 2;
        }

        .node-text-title {
            font-size: 14px;
            font-weight: 600;
            fill: #495057;
            text-anchor: middle;
        }

        .node-text-value {
            font-size: 16px;
            font-weight: 700;
            fill: #212529;
            text-anchor: middle;
        }

        .arrow {
            stroke: #6c757d;
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead);
        }

        .arrow-curved {
            stroke: #6c757d;
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead);
        }

        .arrow-label {
            font-size: 12px;
            fill: #6c757d;
            text-anchor: middle;
        }

        .rate-label {
            font-size: 11px;
            fill: #6c757d;
            text-anchor: middle;
        }
    </style>
</head>
<body>
    <div class="diagram-container" id="diagram-container">
        <div class="loading-overlay" id="loading-overlay">
            <div class="loading">ë°ì´í„° ë¡œë”© ì¤‘...</div>
        </div>
    </div>
    <div class="error-message" id="error-message"></div>

    <script>
        // í•˜ë“œì½”ë”©ëœ ì„¤ì •ê°’
        const SHEET_ID = '1Up0FHYHBlYzZhdDvcVBe9xHZWVxefUQNg5CRgXlzZbE';
        const API_KEY = 'AIzaSyCtgQLWJiGP1c4GfY-gLXBnIZNZH71XMVc';
        const SHEET_NAME = '2026';

        // ê¸°ë³¸ê°’ (ì—ëŸ¬ ì‹œ ì‚¬ìš©)
        const DEFAULT_DATA = {
            í˜„ì¬ê³ ê°: '-',
            ì›”ê°„ì´íƒˆ: '-',
            ì¶”ì²œ: '-',
            ì‹ ê·œê³ ê°: '-',
            í™œì„±ê³ ê°: '-',
            ì›”ë°©ë¬¸ì: '-',
            ê´€ì‹¬ê³ ê°: '-',
            ì´íƒˆìœ¨: '-',
            ì¶”ì²œìœ¨: '-',
            ì „í™˜ìœ¨: '-',
            í™œë³´ìœ¨: '-'
        };

        async function loadFromSheets() {
            try {
                const range = `${SHEET_NAME}!A:L`;
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${range}?key=${API_KEY}`;
                
                console.log('ğŸ“¡ API ìš”ì²­:', url);
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`API ì˜¤ë¥˜ (${response.status})`);
                }
                
                const data = await response.json();
                console.log('ğŸ“¥ ë°›ì€ ë°ì´í„°:', data);
                
                if (!data.values || data.values.length < 2) {
                    throw new Error('ë°ì´í„°ê°€ ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (ìµœì†Œ 2í–‰ í•„ìš”)');
                }

                // 2ë²ˆì§¸ í–‰ ë°ì´í„° (index 1)
                const row = data.values[1];
                const headers = data.values[0];
                
                console.log('ğŸ“‹ í—¤ë”:', headers);
                console.log('ğŸ“Š ë°ì´í„° í–‰:', row);
                
                // ë°ì´í„° íŒŒì‹± (í—¤ë” ê¸°ë°˜)
                const dataMap = {};
                headers.forEach((header, idx) => {
                    dataMap[header] = row[idx] || '0';
                });

                console.log('ğŸ—ºï¸ ë§¤í•‘ëœ ë°ì´í„°:', dataMap);

                // í•„ìš”í•œ ê°’ë“¤ ì¶”ì¶œ - ë¬¸ìì—´ì„ ìˆ«ìë¡œ ë³€í™˜
                const í˜„ì¬ê³ ê° = parseInt(dataMap['í˜„ì¬ê³ ê°']) || 0;
                const ì›”ê°„ì´íƒˆ = parseInt(dataMap['ì›”ê°„ì´íƒˆ']) || 0;
                const ì¶”ì²œ = parseInt(dataMap['ì¶”ì²œ']) || 0;
                const ì‹ ê·œê³ ê° = parseInt(dataMap['ì‹ ê·œê³ ê°']) || 0;
                const í™œì„±ê³ ê° = parseInt(dataMap['í™œì„±ê³ ê°']) || 0;
                const ì›”ë°©ë¬¸ì = parseInt(dataMap['ì›”ë°©ë¬¸ì']) || 0;
                const ê´€ì‹¬ê³ ê° = parseInt(dataMap['ê´€ì‹¬ê³ ê°']) || 0;
                
                console.log('ğŸ”¢ íŒŒì‹±ëœ ìˆ«ì:', {
                    í˜„ì¬ê³ ê°, ì›”ê°„ì´íƒˆ, ì¶”ì²œ, ì‹ ê·œê³ ê°, í™œì„±ê³ ê°, ì›”ë°©ë¬¸ì, ê´€ì‹¬ê³ ê°
                });

                // ê³„ì‚°ëœ ë¹„ìœ¨
                const ì´íƒˆìœ¨ = í˜„ì¬ê³ ê° > 0 ? ((ì›”ê°„ì´íƒˆ / í˜„ì¬ê³ ê°) * 100).toFixed(1) : '0.0';
                const ì¶”ì²œìœ¨ = ì‹ ê·œê³ ê° > 0 ? ((ì¶”ì²œ / ì‹ ê·œê³ ê°) * 100).toFixed(0) : '0';
                const ì „í™˜ìœ¨ = ê´€ì‹¬ê³ ê° > 0 ? ((ì‹ ê·œê³ ê° / ê´€ì‹¬ê³ ê°) * 100).toFixed(0) : '0';
                const í™œë³´ìœ¨ = ì›”ë°©ë¬¸ì > 0 ? ((ê´€ì‹¬ê³ ê° / ì›”ë°©ë¬¸ì) * 100).toFixed(0) : '0';

                console.log('ğŸ“ˆ ê³„ì‚°ëœ ë¹„ìœ¨:', { ì´íƒˆìœ¨, ì¶”ì²œìœ¨, ì „í™˜ìœ¨, í™œë³´ìœ¨ });

                const displayData = {
                    í˜„ì¬ê³ ê°: í˜„ì¬ê³ ê°.toLocaleString(),
                    ì›”ê°„ì´íƒˆ: ì›”ê°„ì´íƒˆ.toLocaleString(),
                    ì¶”ì²œ: ì¶”ì²œ.toLocaleString(),
                    ì‹ ê·œê³ ê°: ì‹ ê·œê³ ê°.toLocaleString(),
                    í™œì„±ê³ ê°: í™œì„±ê³ ê°.toLocaleString(),
                    ì›”ë°©ë¬¸ì: ì›”ë°©ë¬¸ì.toLocaleString(),
                    ê´€ì‹¬ê³ ê°: ê´€ì‹¬ê³ ê°.toLocaleString(),
                    ì´íƒˆìœ¨,
                    ì¶”ì²œìœ¨,
                    ì „í™˜ìœ¨,
                    í™œë³´ìœ¨
                };

                console.log('âœ… ìµœì¢… í‘œì‹œ ë°ì´í„°:', displayData);

                drawDiagram(displayData);

                // ë¡œë”© ì˜¤ë²„ë ˆì´ ì œê±°
                document.getElementById('loading-overlay').style.display = 'none';
                
            } catch (error) {
                console.error('âŒ ì˜¤ë¥˜ ë°œìƒ:', error);
                
                // ê¸°ë³¸ê°’ìœ¼ë¡œ ë‹¤ì´ì–´ê·¸ë¨ í‘œì‹œ
                drawDiagram(DEFAULT_DATA);
                
                // ë¡œë”© ì˜¤ë²„ë ˆì´ ì œê±°
                document.getElementById('loading-overlay').style.display = 'none';
                
                // ì—ëŸ¬ ë©”ì‹œì§€ í•˜ë‹¨ í‘œì‹œ
                const errorEl = document.getElementById('error-message');
                errorEl.innerHTML = `<strong>âš ï¸ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:</strong> ${error.message}. ë¸Œë¼ìš°ì € ì½˜ì†”(F12)ì„ í™•ì¸í•˜ì„¸ìš”.`;
                errorEl.classList.add('show');
            }
        }

        function drawDiagram(data) {
            console.log('ğŸ¨ ë‹¤ì´ì–´ê·¸ë¨ ê·¸ë¦¬ê¸° ì‹œì‘:', data);
            
            const container = document.getElementById('diagram-container');
            
            const svg = `
<svg viewBox="0 0 1400 400" xmlns="http://www.w3.org/2000/svg">
    <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
            <polygon points="0 0, 10 3, 0 6" fill="#6c757d" />
        </marker>
    </defs>
    
    <!-- ìƒë‹¨ íë¦„ (5ê°œ ë…¸ë“œ) -->
    
    <!-- í˜„ì¬ ê³ ê° -->
    <rect x="30" y="30" width="150" height="70" class="node-box"/>
    <text x="105" y="55" class="node-text-title">í˜„ì¬ ê³ ê°</text>
    <text x="105" y="85" class="node-text-value">${data.í˜„ì¬ê³ ê°}ëª…</text>
    
    <!-- í™”ì‚´í‘œ: í˜„ì¬ ê³ ê° â†’ ì›”ê°„ ì´íƒˆ -->
    <line x1="180" y1="65" x2="245" y2="65" class="arrow"/>
    <text x="213" y="55" class="arrow-label">-</text>
    
    <!-- ì›”ê°„ ì´íƒˆ -->
    <rect x="245" y="30" width="150" height="70" class="node-box"/>
    <text x="320" y="55" class="node-text-title">ì›”ê°„ ì´íƒˆ</text>
    <text x="320" y="85" class="node-text-value">${data.ì›”ê°„ì´íƒˆ}ëª…</text>
    
    <!-- í™”ì‚´í‘œ: ì›”ê°„ ì´íƒˆ â†’ ì¶”ì²œ -->
    <line x1="395" y1="65" x2="460" y2="65" class="arrow"/>
    <text x="428" y="55" class="arrow-label">+</text>
    
    <!-- ì¶”ì²œ -->
    <rect x="460" y="30" width="150" height="70" class="node-box"/>
    <text x="535" y="55" class="node-text-title">ì¶”ì²œ</text>
    <text x="535" y="85" class="node-text-value">${data.ì¶”ì²œ}ëª…</text>
    
    <!-- í™”ì‚´í‘œ: ì¶”ì²œ â†’ ì‹ ê·œ ê³ ê° -->
    <line x1="610" y1="65" x2="675" y2="65" class="arrow"/>
    <text x="643" y="55" class="arrow-label">+</text>
    
    <!-- ì‹ ê·œ ê³ ê° -->
    <rect x="675" y="30" width="150" height="70" class="node-box"/>
    <text x="750" y="55" class="node-text-title">ì‹ ê·œ ê³ ê°</text>
    <text x="750" y="85" class="node-text-value">${data.ì‹ ê·œê³ ê°}ëª…</text>
    
    <!-- í™”ì‚´í‘œ: ì‹ ê·œ ê³ ê° â†’ í™œì„± ê³ ê° -->
    <line x1="825" y1="65" x2="890" y2="65" class="arrow"/>
    <text x="858" y="55" class="arrow-label">=</text>
    
    <!-- í™œì„± ê³ ê° -->
    <rect x="890" y="30" width="150" height="70" class="node-box"/>
    <text x="965" y="55" class="node-text-title">í™œì„± ê³ ê°</text>
    <text x="965" y="85" class="node-text-value">${data.í™œì„±ê³ ê°}ëª…</text>
    
    <!-- í•˜ë‹¨ íë¦„ -->
    
    <!-- ì›” ë°©ë¬¸ì -->
    <rect x="30" y="260" width="150" height="70" class="node-box"/>
    <text x="105" y="285" class="node-text-title">ì›” ë°©ë¬¸ì</text>
    <text x="105" y="315" class="node-text-value">${data.ì›”ë°©ë¬¸ì}ëª…</text>
    
    <!-- í™”ì‚´í‘œ: ì›” ë°©ë¬¸ì â†’ ì†”ë£¨ì…˜ -->
    <line x1="180" y1="295" x2="295" y2="295" class="arrow"/>
    <text x="238" y="285" class="arrow-label">í™œë³´</text>
    <text x="238" y="310" class="rate-label">${data.í™œë³´ìœ¨}%</text>
    
    <!-- ì†”ë£¨ì…˜ (ìœ¡ê°í˜•) -->
    <polygon points="350,265 420,265 450,295 420,325 350,325 320,295" class="node-factory"/>
    <text x="385" y="290" class="node-text-title">ì†”ë£¨ì…˜</text>
    <text x="385" y="310" class="node-text-title">(ê³µì¥)</text>
    
    <!-- í™”ì‚´í‘œ: ì†”ë£¨ì…˜ â†’ ê´€ì‹¬ ê³ ê° -->
    <line x1="450" y1="295" x2="565" y2="295" class="arrow"/>
    
    <!-- ê´€ì‹¬ ê³ ê° -->
    <rect x="565" y="260" width="150" height="70" class="node-box"/>
    <text x="640" y="285" class="node-text-title">ê´€ì‹¬ ê³ ê°</text>
    <text x="640" y="315" class="node-text-value">${data.ê´€ì‹¬ê³ ê°}ëª…</text>
    
    <!-- í”¼ë“œë°± ë£¨í”„ë“¤ (ê³¡ì„  í™”ì‚´í‘œ) -->
    
    <!-- ì´íƒˆ â†’ ì†”ë£¨ì…˜ ê³¡ì„  í™”ì‚´í‘œ -->
    <path d="M 320 100 Q 320 185 385 265" class="arrow-curved"/>
    <text x="280" y="170" class="rate-label">ì´íƒˆ ${data.ì´íƒˆìœ¨}%</text>
    
    <!-- ì¶”ì²œ â†’ ì†”ë£¨ì…˜ ê³¡ì„  í™”ì‚´í‘œ -->
    <path d="M 535 100 Q 460 185 385 265" class="arrow-curved"/>
    <text x="490" y="170" class="rate-label">ì¶”ì²œ ${data.ì¶”ì²œìœ¨}%</text>
    
    <!-- ì‹ ê·œ ê³ ê° â†’ ê´€ì‹¬ ê³ ê° ê³¡ì„  í™”ì‚´í‘œ -->
    <path d="M 750 100 Q 750 180 640 260" class="arrow-curved"/>
    <text x="770" y="170" class="rate-label">ì „í™˜ ${data.ì „í™˜ìœ¨}%</text>
    
    <!-- ê´€ì‹¬ ê³ ê° â†’ ì†”ë£¨ì…˜ ê³¡ì„  í™”ì‚´í‘œ (ìœ ì§€) -->
    <path d="M 565 295 Q 507 295 450 295" class="arrow-curved"/>
    <text x="507" y="350" class="rate-label">ìœ ì§€</text>
</svg>
            `;
            
            // ê¸°ì¡´ SVGê°€ ìˆìœ¼ë©´ êµì²´, ì—†ìœ¼ë©´ ì¶”ê°€
            const existingSvg = container.querySelector('svg');
            if (existingSvg) {
                existingSvg.outerHTML = svg;
            } else {
                container.innerHTML = svg + container.innerHTML;
            }
            
            console.log('âœ… ë‹¤ì´ì–´ê·¸ë¨ ë Œë”ë§ ì™„ë£Œ');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        window.addEventListener('load', () => {
            console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ, ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹œì‘');
            loadFromSheets();
        });
    </script>
</body>
</html>
